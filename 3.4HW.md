## Домашнее задание к занятию "3.4. Операционные системы, лекция 2 ###
#
### На лекции мы познакомились с node_exporter. В демонстрации его исполняемый файл запускался в background. Этого достаточно для демо, но не для настоящей production-системы, где процессы должны находиться под внешним управлением. Используя знания из лекции по systemd, создайте самостоятельно простой unit-файл для node_exporter: 
* поместите его в автозагрузку,
предусмотрите возможность добавления опций к запускаемому процессу через внешний файл (посмотрите, например, на systemctl cat cron),
удостоверьтесь, что с помощью systemctl процесс корректно стартует, завершается, а после перезагрузки автоматически поднимается.
* =================================================================
* sudo apt install prometheus-node-exporter
* sudo useradd nodex1 -s /sbin/nologin  // пользователь для запуска nodex
* sudo touch /etc/sysconf/nodex         // файл конфигурации nodex
* sudo nano  /etc/systemd/system/nodex.service // unit-файл для node_exporter:
* ==================================================
* [Unit]
* Description=Node Exporter
*
* [Service]
* User=nodex1
* EnvironmentFile=/etc/sysconf/nodex
* ExecStart=/usr/bin/prometheus-node-exporter $OPTIONS
* 
* [Install]
* WantedBy=multi-user.target
* ===================================================
* sudo systemctl daemon-reload
* sudo systemctl enable nodex
* sudo systemctl start nodex
* sudo systemctl status nodex
* ● nodex.service - Node Exporter
*     Loaded: loaded (/etc/systemd/system/nodex.service; enabled; vendor preset: enabled)
*    Active: active (running) since Tue 2022-02-15 13:56:55 UTC; 21min ago
* sudo reboot
*  sudo systemctl status nodex
* ● nodex.service - Node Exporter
*     Loaded: loaded (/etc/systemd/system/nodex.service; enabled; vendor preset: enabled)
*     Active: active (running) since Tue 2022-02-15 13:56:55 UTC; 25min ago
*   Main PID: 657 (prometheus-node)
* =======================================================

### Ознакомьтесь с опциями node_exporter и выводом /metrics по-умолчанию. Приведите несколько опций, которые вы бы выбрали для базового мониторинга хоста по CPU, памяти, диску и сети.
* sudo apt install lynx
* lynx http://localhost:9100/metrics  скрин прилагаю Grodzenskiy_3_4_2.JPG
* # TYPE node_cpu_seconds_total counter
* node_cpu_seconds_total{cpu="0",mode="idle"} 2357.25
* node_cpu_seconds_total{cpu="0",mode="iowait"} 10.83
* node_cpu_seconds_total{cpu="0",mode="irq"} 0
* node_cpu_seconds_total{cpu="0",mode="nice"} 4.43
* node_cpu_seconds_total{cpu="0",mode="softirq"} 0.48
* node_cpu_seconds_total{cpu="0",mode="steal"} 0
* node_cpu_seconds_total{cpu="0",mode="system"} 5.24
* node_cpu_seconds_total{cpu="0",mode="user"} 14.74
* # TYPE node_disk_io_now gauge
* node_disk_io_now{device="dm-0"} 0
* node_disk_io_now{device="dm-1"} 0
* node_disk_io_now{device="sda"} 0
* node_disk_io_now{device="sr0"} 0
* # TYPE node_disk_io_time_seconds_total counter
* node_disk_io_time_seconds_total{device="dm-0"} 7.872
* node_disk_io_time_seconds_total{device="dm-1"} 0.064
* node_disk_io_time_seconds_total{device="sda"} 8.104000000000001
* node_disk_io_time_seconds_total{device="sr0"} 0
* # TYPE node_memory_MemAvailable_bytes gauge
* node_memory_MemAvailable_bytes 6.91421184e+08
* # TYPE node_memory_MemFree_bytes gauge
* node_memory_MemFree_bytes 4.86002688e+08
* # TYPE node_network_receive_errs_total counter
* node_network_receive_errs_total{device="eth0"} 0
* # TYPE node_network_transmit_errs_total counter
* node_network_transmit_errs_total{device="eth0"} 0
* ===================================================

### Установите в свою виртуальную машину Netdata. Воспользуйтесь готовыми пакетами для установки (sudo apt install -y netdata). После успешной установки:

в конфигурационном файле /etc/netdata/netdata.conf в секции [web] замените значение с localhost на bind to = 0.0.0.0,
добавьте в Vagrantfile проброс порта Netdata на свой локальный компьютер и сделайте vagrant reload:
config.vm.network "forwarded_port", guest: 19999, host: 19999
После успешной перезагрузки в браузере на своем ПК (не в виртуальной машине) вы должны суметь зайти на localhost:19999. Ознакомьтесь с метриками, которые по умолчанию собираются Netdata и с комментариями, которые даны к этим метрикам.

*  

